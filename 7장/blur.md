# 블러링: 영상 부드럽게 하기

 - 블러링은 초점이 맞지 않는 사진처럼 영상을 부드럽게 만드는 필터링
 - 영상을 부드럽게 만드는 용도 혹은 영상의 노이즈를 제거하는 전처리 과정으로 사용
 - 비교적 쉬운 평균값 필터와 좀 더 자연스러운 가우시안 필터에 대해 설명

## 평균값 필터

 - 입력 영상에서 트정 픽셀과 주변 픽셀의 산술 평균을 결과 영상의 픽셀 값으로 설정
 - 급격한 변화가 줄어들어 물체의 에지가 무너지고 노이즈가 크게 사라진다
 - 과도한 사용의 경우 영상이 뭉개져서 물체 구분이 어려워진다
 - 다음은 평균값 필터에 사용되는 3x3, 9x9 마스크이다

 (대충 마스크 나타내는 사진)

 OpenCV 에서는 `blur()` 함수를 이용해 평균값 필터 수행이 가능하다.

 ```c++
 void blur(InputArray src, OutputArray dst, Size ksize,
            Point anchor = Point(-1, -1), int borderType = BORDER_DEFAULT);
 ```

 변수 | 의미
 --- |:---
 src | 입력 영상. 다채널 영상은 각 채널별로 블러링을 수행한다. 입력 영상의 깊이는 CV_8U, CV_16U, CV_16S, CV_32F, CV_64F 중 하나여야 한다.
 dst | 출력 영상. src와 같은 크기, 같은 채널 수를 갖는다.
 ksize | 브러링 커널 크기
 anchor | 고정점 좌표, `Point(-1, -1)`을 지정하면 커널 중심을 고정점으로 사용한다.
 borderType | 가장자리 픽셀 확장 방식

`blur()`함수는 입력 영상에 `ksize` 크기의 평균값 필터 마스클 사용하여 출력 영상을 생성한다. 다음은 `blur()`함수에서 사용하는 커널이다.

(대충 커널 사진)

(대충 blur 사용한 예제 코드 주소)

(대충 예제 코드 결과 사진)

## 가우시안 필터

 - 가우시안 필터는 평균값 필터보다 더 자연스러운 블러링 효과를 보여준다
 - 가우시안 분포 함수를 근사하여 생성한 필터 마스크 사용

### 가우시안 분포

 - 가우시안 분포는 평균을 중심으로 좌우 대칭의 종 모양을 갖는 확률 분포를 말하며 정규 분포라고도 한다.
 - 자연계에서 발생하는 대부분의 사건은 가우시안 분포를 따른다.
 - 가우시안 분포는 평균과 표준 편차에 따라 분포 모양이 결정된다.
 - 영상의 가우시안 필터에서는 주로 평균이 0인 가우시안 분포 함수를 사용한다.
 - 평균이 0이고 표준 편차가 `sigma`인 1차원 가우시안 분포는 다음과 같다.

 (대충 1차원 가우시안 분포 수식 과 그래프)

#### 2차원 가우시안 분포

 - 가우시안 필터는 2차원 가우시안 분포 함수를 근사해야 함. 
 - 2차원 가우시안 분포 함수는 x, y 두 개의 변수를 사용하고 각 변수에 따라 독립적인 편차를 설정한다.
 - 평균은 (0, 0)이고 `sigmaX = sigmaY = 1.0`인 2차원 가우시안 분포 함수는 `그림`과 같다.
 - 가우시안 분포에서 이산형의 마스크를 사용하기 위해 x와 y가 정수인 부분에서만 값을 추출

 (대충 2차원 가우시안 분포 수식과 그래프)

#### 가우시안 분포 곱 연산

 - 2차원 가우시안 분포는 두 개의 1차원 가우시안 분포 함수의 곱으로 분리 `(수식)`
 - 이를 이용해 가우시안 필터 연산시 두 개의 1차원 마스크를 이용해 연산 가능
 - 이는 크기가 `n`인 마스크 크기에 대해 `O(n^2)` 시간 복잡도를 `O(n)`으로 줄일 수 있음

 (대충 2차원 가우시안 분포를 1차원 가우시안 분포의 곱으로 나누는 수식)

```c++
void GaussianBlur(InputArray src, OutputArray dst, Size ksize,
                    double sigmaX, double sigmaY = 0,
                    int borderType = BORDER_DEFAULT);
```
변수 | 의미
--- |:---
src | 입력 영상. 다채널 영상은 각 채널별로 블러링을 수행
dst | 출력 영상. src와 같은 크기, 같은 타입
ksize | 가우시안 커널 크기. ksize.width 와 ksize.height는 0보다 큰 홀수여야 함. ksize에 Size()를 지정하면 표준편차로부터 커널 크기를 자동으로 결정
sigmaX | x 방향으로의 가우시안 커널 표준 편차
sigmaY | y 방향으로의 가우시안 커널 표준 편차. 이 값이 0이면 sigmaX와 같은 값 사용. 만일 두 값 모두다 0이면 ksize의 width 와 height로 부터 표준 편차 계산하여 사용
borderType | 가장자리 픽셀 확장 방식

(대충 예제 코드 링크)

 `GaussianBlur()` 함수는 가우시안 블러링을 하는 함수이다. 이는 1차원 가우시안 필터를 두 번 적용하여 필터링을 수행한다. 이때 1차원 가우시안 필터 마스크를 생성하기 위해 `getGaussianKernel()`함수를 사용한다. 이 함수가 반환하는 행렬의 원소는 다음의 수식을 따른다.

 (대충 원소에 대한 수식)

```c++
Mat getGaussiankernel(int ksize, double sigma, int ktype = CV_64F);
```

변수 | 의미
--- |:---
ksize | 커널 크기. ksize는 0보다 큰 홀수
sigma | 가우시안 표준 편차. 만일 `sigma<=0` 이면 sigma = 0.3*((ksize-1)*0.5)-1+0.8 형태로 sigma 계산
ktype | 필터의 타입. CV_32F 또는 CV_64F
반환값 | ksize x 1 크기의 가우시안 필터 커널

 