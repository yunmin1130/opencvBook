# 잡음 제거 필터링

 - 어떤 영상이든 잡음은 포함되어 있다.
 - 많은 컴퓨터 비전 시스템에서 전처리 과정으로 잡음 제거 필터를 사용

## 영상과 잡음 모델

 - 디지털 카메라에서 사진을 촬영하는 경우 광학적 신호를 전기적 신호로 변환하는 센서에서 주로 잡음 발생
 - 원본 신호를 s(x, y), 잡음을 n(x, y)라고 하면 영상신호는 f(x, y)로 표현할 수 있다.
 - 대표적인 잡음 모델은 가우시안 잡음 모델이다.

(대충 가우시안 분포 그래프)

```c++
void randn(InputOutputArray dst, InputArray mean, InputArray stddev);
```

변수 | 의미
--- |:---
dst | 가우시안 난수로 채워질 행렬. dst 행렬은 미리 할당이 되어 있어야 한다.
mean | 가우시안 분포 평균
stddev | 가우시안 분포 표준 편차

 `randn()`함수는 dst 행렬을 가우시안 분포를 따르는 난수로 채운다. 이때 dst 행렬의 자료형에 맞춰 포화 연산이 수행된다.

 (대충 잡음 생성 예제 코드 링크)

## 양방향 필터

 - 대부분 가우시안 잡음을 제거하기 위해 가우시안 필터 사용
 - 가우시안 필터는 에지 부분을 블러링 하기 때문에 에지가 뭉개지게 된다.
 - 이러한 단점을 보완하기 위해 에지 보전 잡음 제거 필터중 하나인 양방향 필터 사용

 (대충 양방향 필터에 사용하는 공식)

 변수 | 의미
 --- |:---
 f | 입력 영상
 g | 출력 영상
 p | 입력 영상의 픽셀 좌표
 q | 출력 영상의 픽셀 좌표
 G_sigma_s | 표준 편차가 sigma_s인 가우시안 분포 함수
 G_sigma_r | 표준 편차가 sigma_r인 가우시안 분포 함수
 W_p | 양방향 필터 마스크 합이 1이 되도록 만드는 정규화 상수

 - 두 개의 가우시안 함수 곱으로 구성된 필터
 - 거리에 대한 가우시안 분포 값과 픽셀 값 차이에 대한 가우시안 분포 값으로 나뉜다.
 - 픽셀 간의 거리가 멀 수록 적은 가중치를 갖도록 한다.
 - 픽섹 값의 차이가 클 수록 적은 가중치를 갖도록 한다.
 - 이를 이용하면 픽셀 값 차이가 큰 주변 픽셀과는 블러링이 적게 되도록 한다.
 - 다만, 모든 픽셀 위치에서 독립된 고유의 필터 마스크 행렬을 만들어야 하기 때문에 연산량이 많다.

 (대충 양방향 필터에 사용된 수식)

 ```c++
 void bilateralFilter(InputArray src, OutputArray dst, int d,
                        double sigmaColor, double sigmaSpace,
                        int borderType = BORDER_DEFAULT);
 ```

 변수 | 의미
 --- |:---
 src | 입력 영상. 8비트 또는 실수형, 1채널 또는 3채널 영상
 dst | 출력 영상. src와 같은 크기, 같은 타입
 d | 필터링에 사용할 이웃 픽셀과의 거리(지름). 양수가 아니면 sigmaSpace로 부터 자동 계산
 sigmaColor | 색 공간에서의 가우시안 필터 표준 편차
 sigmaSpace | 좌표 공간에서의 가우시안 필터 표준 편차
 borderType | 가장자리 픽셀 확장 방식

 - `sigmaColor`값을 작게 지정할 경우, 픽셀 값 차이가 큰 주변 픽셀과는 블러링이 적게 된다.
 - `sigmaColor`값을 이용하여 어느 정도 밝기 차를 갖는 에지를 보존할 지 조정할 수 있다.

 (대충 양방향 필터 예제 코드 링크)

## 미디언 필터

 - 자기 자신을 포함한 주변 픽셀 값을 정렬하여 중간 값을 선택하여 픽셀 값으로 설정한다.
 - 미디언 필터는 잡음 픽셀 값이 주변 픽셀 값과 큰 차이가 있는 경우 효과적이다.
 - 소금&후추 잡음의 경우 픽셀 값이 일정 확률로 0 혹은 255가 되는데 이러한 잡음에 미디언 필터를 이용한다.

 (대충 미디언 필터 사진)

 ```c++
 void medianBlur(InputArray src, OutputArray dst, int ksize);
 ```

 변수 | 의미
 --- |:---
 src | 입력 영상. 1, 3, 4채널 영상. ksize가 3 또는 5이면 src는 CV_8U, CV_16U, CV_32F의 깊이를 가질 수 있고, 그 이상의 필터 크기에는 CV_8U 깊이만 사용 가능
 dst | 출력 영상. src와 같은 크기, 같은 타입
 ksize | 필터 크기. 3보다 같거나 큰 홀수를 지정

 `medianBlur()` 함수는 `ksize`x`ksize` 필터 크기를 이용하여 미디언 필터링을 수행한다. 다 채널 영상인 경우 각 채널별로 필터링을 수행한다. 이 함수는 내부적으로 `BORDER_REPLICATE`방식으로 외곽 픽셀 값을 정한다.

 (대충 median filter 예제 코드 링크)
